#!/bin/sh

# Detect the operating system
OS=$(uname -s)

# Function to create Makevars.os
create_makevars() {
  echo "PKG_CXXFLAGS = -g -O3 -Wall -pedantic -std=gnu++17" > src/Makevars.os
  echo "PKG_LIBS = ${LAPACK_LIBS} ${BLAS_LIBS} ${FLIBS}" >> src/Makevars.os
  echo "Generated src/Makevars.os content:"
  cat src/Makevars.os
}

# Create src/Makevars.os with the appropriate settings
if [ "$OS" = "Linux" ]; then
  echo "Detected Linux"
  LAPACK_LIBS=$(R CMD config LAPACK_LIBS)
  BLAS_LIBS=$(R CMD config BLAS_LIBS)
  FLIBS=$(R CMD config FLIBS)

  if [ -n "$LAPACK_LIBS" ] && [ -n "$BLAS_LIBS" ] && [ -n "$FLIBS" ]; then
    create_makevars
  else
    echo "Error: Unable to find LAPACK, BLAS, or Fortran libraries"
    exit 1
  fi
else
  echo "No specific configuration needed for $OS"
fi
